/**
 * dropdown.dot.js
 *
 * A super-flexible and clean JQuery Dropdown Plugin based on dot.js Templates.
 *
 * @author Roger Dudler <roger.dudler@gmail.com>
 */
(function(f){f.fn.dropdown=function(m){var b=f.extend({selected:".selected",items:"ul",item:"li",openClass:"open",changed:function(b){}},m);return this.each(function(){function n(a,c){var g=f(a);d.find(b.item).removeClass("hover");g.addClass("hover");c&&g.parent().scrollTop(g.position().top-g.height())}function r(q){var c=f(q).data("index"),g=h.items[c];a.find("> "+b.selected).html(s(g));d.find("[data-index="+k+"]").removeClass("selected");k=c;f(q).addClass("selected");e.val(g.value);b.changed(g);
p()}function l(){d.show();a.addClass(b.openClass)}function p(){d.hide();a.removeClass(b.openClass)}var e=f(this);e.hide();var m=doT.template(f(e.data("template")).text()),s=doT.template(f(e.data("template")+"-selected").text()),h={selected:null,items:[],classes:e.data("classes")},k=0;f.each(e.find("option"),function(b,c){var a=f(c),d={value:a.attr("value"),label:a.text(),selected:a.is(":selected")},e=a.data();f.each(e,function(a,b){d[a]=b});a.is(":selected")&&(h.selected=d,k=b);h.items.push(d)});
var a=f(m(h));a.attr({"data-id":e.attr("id")});a.addClass(e.attr("class"));var d=a.find(b.items);a.find("> "+b.selected).on("mousedown",function(){a.focus();d.is(":visible")?p():l();return!1});a.on("focus",function(){e.addClass("focus")});a.on("blur",function(){e.removeClass("focus");p()});a.on("keydown",function(e){var c=null;switch(e.keyCode){case 40:a.hasClass(b.openClass)?(c=d.find(".hover").next(b.item).first(),c.length||(c=d.find(b.item).first())):(l(),c=d.find(".selected"));n(c,!0);e.preventDefault();
break;case 38:a.hasClass(b.openClass)?(c=d.find(".hover").prev(b.item).first(),c.length||(c=d.find(b.item).last())):(l(),c=d.find(".selected"));n(c,!0);e.preventDefault();break;case 13:a.hasClass(b.openClass)?(c=d.find(".hover").first())&&r(c):l(),e.preventDefault()}});d.find("[data-index="+k+"]").addClass("selected");d.on("mousedown",b.item,function(){r(this);return!1});d.on("mouseover",b.item,function(){n(this,!1)});return e.before(a)})}})(jQuery);
